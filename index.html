<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incident Dashboard</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Load Babel for JSX support -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- ICONS (SVG Components) ---
        const IconBase = ({ children, className }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" height="24" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Activity = ({ className }) => (
            <IconBase className={className}>
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </IconBase>
        );

        const CheckCircle = ({ className }) => (
            <IconBase className={className}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </IconBase>
        );

        const Clock = ({ className }) => (
            <IconBase className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </IconBase>
        );

        const AlertTriangle = ({ className }) => (
            <IconBase className={className}>
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </IconBase>
        );

        const BarChart2 = ({ className }) => (
            <IconBase className={className}>
                <line x1="18" y1="20" x2="18" y2="10"></line>
                <line x1="12" y1="20" x2="12" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="14"></line>
            </IconBase>
        );

        const Wrench = ({ className }) => (
            <IconBase className={className}>
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
            </IconBase>
        );


        // --- DATA ---
        const STATS = {
            total: 1210,
            inProgress: 610,
            done: 600
        };

        const CAUSE_RAW = [
            { name: "Link upNo Up/Down", count: 373 },
            { name: "Port Sim Router One 540 Up - Down", count: 103 },
            { name: "Alarm Power", count: 33 },
            { name: "Port Sim Router Cisco 819 Up - Down", count: 32 },
            { name: "Router ONE540 เสีย", count: 23 },
            { name: "Router Cisco819 เสีย", count: 20 },
            { name: "ค่า Power ไม่ดี", count: 5 },
            { name: "Port Lan Modem Up Down", count: 3 },
            { name: "ปลั๊กหลวม", count: 2 },
            { name: "GPON ZTE Modem", count: 1 },
            { name: "HUB D-LINK เสีย", count: 1 },
            { name: "Port Sim Router Router huawei AR Up - Down", count: 1 },
            { name: "SC Connector เสีย", count: 1 },
            { name: "Sim สกปรก", count: 1 },
            { name: "สาย Lan หลวม", count: 1 }
        ];

        const RESOLUTION_RAW = [
            { name: "Link upNo Up/Down", count: 377 },
            { name: "Swap Sim To Ais Sim", count: 75 },
            { name: "Change to Router huawei AR", count: 73 },
            { name: "Alarm Power Clear", count: 33 },
            { name: "RESET (โดยเจ้าหน้าที่หน้างาน)", count: 18 },
            { name: "Remote Reset", count: 5 },
            { name: "รอส่งช่างตรวจสอบ", count: 4 },
            { name: "ต่อคืนเสียบใหม่", count: 3 },
            { name: "Upgrade firmware cellular", count: 2 },
            { name: "Change SC Connector", count: 1 },
            { name: "Change To Router ONE540", count: 1 },
            { name: "Change to GPON ZTE Modem", count: 1 },
            { name: "Fix Band ของ AR เป็น 3 Band", count: 1 },
            { name: "Link upNo Up/Dow", count: 1 }, 
            { name: "Port Sim Router One 540 Up - Down", count: 1 },
            { name: "RESET (โดยเจ้าหน้าที่หน้างาน) ", count: 1 },
            { name: "ทำความสะอาด", count: 1 },
            { name: "ผู้เช่าตรวจซ่อมเอง", count: 1 },
            { name: "เปลี่ยนใหม่", count: 1 }
        ];

        const COLORS = [
            '#3b82f6', '#ef4444', '#eab308', '#f97316', '#8b5cf6', 
            '#ec4899', '#06b6d4', '#10b981', '#6366f1', '#84cc16',
            '#d946ef', '#f43f5e', '#64748b', '#94a3b8', '#cbd5e1'
        ];

        // --- COMPONENTS ---

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-slate-200 p-6 ${className}`}>
                {children}
            </div>
        );

        const StatCard = ({ title, value, subtext, icon: Icon, colorClass }) => (
            <Card className="flex items-center justify-between transition-all hover:shadow-md hover:-translate-y-1">
                <div>
                    <p className="text-slate-500 text-sm font-medium mb-1">{title}</p>
                    <h3 className="text-3xl font-bold text-slate-800">{value}</h3>
                    <p className={`text-xs mt-2 font-medium ${subtext.includes('+') ? 'text-green-600' : 'text-slate-400'}`}>
                        {subtext}
                    </p>
                </div>
                <div className={`p-4 rounded-full ${colorClass} bg-opacity-10`}>
                    <Icon className={`w-8 h-8 ${colorClass.replace('bg-', 'text-')}`} />
                </div>
            </Card>
        );

        const ProgressBar = ({ label, value, total, color }) => {
            const percentage = ((value / total) * 100).toFixed(1);
            return (
                <div className="group">
                    <div className="flex justify-between mb-1">
                        <span className="text-sm font-medium text-slate-700 flex items-center gap-2 truncate pr-2">
                            {label}
                        </span>
                        <span className="text-sm font-medium text-slate-600 whitespace-nowrap">{value} ({percentage}%)</span>
                    </div>
                    <div className="w-full bg-slate-100 rounded-full h-2 overflow-hidden">
                        <div 
                            className="h-2 rounded-full transition-all duration-1000 ease-out" 
                            style={{ width: `${percentage}%`, backgroundColor: color }}
                        ></div>
                    </div>
                </div>
            );
        };

        const DonutChart = ({ data }) => {
            const sortedData = [...data].sort((a, b) => b.value - a.value);
            const top5 = sortedData.slice(0, 5);
            const othersValue = sortedData.slice(5).reduce((acc, curr) => acc + curr.value, 0);
            
            const chartData = othersValue > 0 
                ? [...top5, { name: 'Others', value: othersValue, color: '#94a3b8' }]
                : top5;

            const total = chartData.reduce((acc, curr) => acc + curr.value, 0);
            let currentAngle = 0;

            return (
                <div className="relative w-48 h-48 mx-auto">
                    <svg viewBox="0 0 100 100" className="transform -rotate-90 w-full h-full">
                        {chartData.map((slice, index) => {
                            const sliceAngle = (slice.value / total) * 360;
                            if (sliceAngle === 0) return null;
                            
                            const x1 = 50 + 40 * Math.cos((Math.PI / 180) * currentAngle);
                            const y1 = 50 + 40 * Math.sin((Math.PI / 180) * currentAngle);
                            const x2 = 50 + 40 * Math.cos((Math.PI / 180) * (currentAngle + sliceAngle));
                            const y2 = 50 + 40 * Math.sin((Math.PI / 180) * (currentAngle + sliceAngle));
                            
                            const largeArcFlag = sliceAngle > 180 ? 1 : 0;
                            
                            const pathData = sliceAngle === 360 
                                ? `M 50 10 A 40 40 0 1 1 49.99 10`
                                : `M 50 50 L ${x1} ${y1} A 40 40 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;
                            
                            const pathElement = (
                                <path
                                    key={index}
                                    d={pathData}
                                    fill={slice.color || COLORS[index % COLORS.length]}
                                    stroke="white"
                                    strokeWidth="2"
                                    className="hover:opacity-80 transition-opacity cursor-pointer"
                                />
                            );
                            
                            currentAngle += sliceAngle;
                            return pathElement;
                        })}
                        <circle cx="50" cy="50" r="25" fill="white" />
                    </svg>
                    <div className="absolute inset-0 flex items-center justify-center flex-col pointer-events-none">
                        <span className="text-xs text-slate-400 font-semibold">DONE</span>
                        <span className="text-xl font-bold text-slate-800">{total}</span>
                    </div>
                </div>
            );
        };

        // --- MAIN DASHBOARD COMPONENT ---
        const Dashboard = () => {
            const [activeTab, setActiveTab] = useState('causes');

            const overallData = [
                { name: 'In Progress', value: STATS.inProgress, color: '#f97316' },
                { name: 'Done', value: STATS.done, color: '#22c55e' },
            ];

            const currentList = activeTab === 'causes' ? CAUSE_RAW : RESOLUTION_RAW;

            return (
                <div className="min-h-screen bg-slate-50 font-sans p-4 md:p-8">
                    {/* Header */}
                    <div className="max-w-7xl mx-auto mb-8">
                        <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div>
                                <h1 className="text-3xl font-bold text-slate-800 flex items-center gap-3">
                                    <BarChart2 className="w-8 h-8 text-blue-600" />
                                    Incident Dashboard
                                </h1>
                                <p className="text-slate-500 mt-1">รายงานสรุปปัญหาและการแก้ไข (Raw Data)</p>
                            </div>
                            <div className="bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-200 text-sm text-slate-600 flex items-center gap-2">
                                <Clock className="w-4 h-4" />
                                Last Updated: Now
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto space-y-6">
                        
                        {/* Top Stats Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <StatCard 
                                title="Total Incidents" 
                                value={STATS.total.toLocaleString()} 
                                subtext="100% ของทั้งหมด"
                                icon={Activity} 
                                colorClass="bg-blue-500" 
                            />
                            <StatCard 
                                title="In Progress" 
                                value={STATS.inProgress.toLocaleString()} 
                                subtext="สาเหตุ: ทีมกำลังตรวจสอบ"
                                icon={Clock} 
                                colorClass="bg-orange-500" 
                            />
                            <StatCard 
                                title="Completed (Done)" 
                                value={STATS.done.toLocaleString()} 
                                subtext="แก้ไขเสร็จสิ้น"
                                icon={CheckCircle} 
                                colorClass="bg-green-500" 
                            />
                        </div>

                        {/* Main Content Grid */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            
                            {/* Left Column: Overall Status */}
                            <Card className="lg:col-span-1 flex flex-col items-center justify-start">
                                <h3 className="text-lg font-bold text-slate-700 w-full mb-6 border-b pb-4">
                                    สถานะงานภาพรวม
                                </h3>
                                <DonutChart data={overallData} />
                                <div className="w-full mt-8 space-y-3">
                                    <div className="flex items-center justify-between p-3 rounded-lg bg-orange-50 border border-orange-100">
                                        <div className="flex items-center gap-3">
                                            <div className="w-3 h-3 rounded-full bg-orange-500"></div>
                                            <div>
                                                <span className="text-sm font-bold text-slate-700 block">In Progress</span>
                                                <span className="text-xs text-slate-500">ทีมกำลังตรวจสอบ</span>
                                            </div>
                                        </div>
                                        <span className="font-bold text-lg text-orange-700">{STATS.inProgress}</span>
                                    </div>
                                    <div className="flex items-center justify-between p-3 rounded-lg bg-green-50 border border-green-100">
                                        <div className="flex items-center gap-3">
                                            <div className="w-3 h-3 rounded-full bg-green-500"></div>
                                            <div>
                                                <span className="text-sm font-bold text-slate-700 block">Done</span>
                                                <span className="text-xs text-slate-500">งานปิดจบ</span>
                                            </div>
                                        </div>
                                        <span className="font-bold text-lg text-green-700">{STATS.done}</span>
                                    </div>
                                </div>
                            </Card>

                            {/* Right Column: Detailed List */}
                            <Card className="lg:col-span-2 flex flex-col h-full">
                                <div className="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
                                    <div>
                                        <h3 className="text-lg font-bold text-slate-800">รายละเอียดงานที่จบแล้ว (Done Analysis)</h3>
                                        <p className="text-sm text-slate-500">ข้อมูลดิบแยกตามหัวข้อจริง (ไม่สรุปกลุ่ม)</p>
                                    </div>
                                    <div className="flex bg-slate-100 p-1 rounded-lg self-start shrink-0">
                                        <button 
                                            onClick={() => setActiveTab('causes')}
                                            className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${activeTab === 'causes' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                                        >
                                            <AlertTriangle className="w-4 h-4" />
                                            สาเหตุ ({CAUSE_RAW.length})
                                        </button>
                                        <button 
                                            onClick={() => setActiveTab('resolutions')}
                                            className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${activeTab === 'resolutions' ? 'bg-white text-purple-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                                        >
                                            <Wrench className="w-4 h-4" />
                                            วิธีการแก้ไข ({RESOLUTION_RAW.length})
                                        </button>
                                    </div>
                                </div>

                                {/* Content Area - Expanded to full height (No Scroll) */}
                                <div className="flex-1 pr-2 space-y-4">
                                    {/* Mini Legend for Top items */}
                                    <div className="flex flex-wrap gap-2 mb-4 text-xs text-slate-500">
                                        <span className="font-semibold mr-1">Top Items:</span>
                                        {currentList.slice(0, 3).map((item, idx) => (
                                            <span key={idx} className="flex items-center gap-1 bg-slate-50 px-2 py-1 rounded border border-slate-100">
                                                <span className="w-2 h-2 rounded-full" style={{ backgroundColor: COLORS[idx] }}></span>
                                                {item.name}
                                            </span>
                                        ))}
                                    </div>

                                    {currentList.map((item, index) => (
                                        <ProgressBar 
                                            key={index} 
                                            label={`${index + 1}. ${item.name}`} 
                                            value={item.count} 
                                            total={STATS.done} 
                                            color={COLORS[index % COLORS.length]}
                                        />
                                    ))}
                                </div>
                            </Card>
                        </div>
                    </div>
                </div>
            );
        };

        // Mount the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>
</html>
